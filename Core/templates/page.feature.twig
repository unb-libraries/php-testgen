# Behat Page Access Test
# Ref : phase2/behat-suite

Feature: Visit a page
  As an internet user
  In order to use a website
  I need to be able to access a page.

{% if public %}

  Scenario: Grant public access
    Given I am not logged in
    When I go to "{{ path }}"
    {% if title %}
    Then I should see "{{ title }}"
    {% else %}
    Then the response status code should be 200
    {% endif %}

{% else %}

  {% if grant_access is not empty %}
  Background:
    {% set vars = {'user_roles': grant_access} %}
    {%- include '_user_table.feature.twig' with vars only -%}

    {% for user_role in grant_access %}
      {% set user = "user_%s"|format(loop.index) %}
      Scenario: Grant acccess to {{ user }}
        Given I am logged in as {{ user }}
        When I go to {{url}}
        Then I should get an HTTP 200 response
    {% endfor %}
  {% endif %}

  Scenario: Deny acccess to unauthenticated users
    Given I am not logged in
    When I go to "{{ path }}"
    Then I should get an HTTP 403 response

{% endif %}
